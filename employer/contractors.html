<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contractors — ORDIN</title>
  <link rel="stylesheet" href="../css/site.css" />
</head>
<body>
<header class="topbar">
  <div class="container row between center">
    <a class="brand row center gap-10" href="../index.html">
      <img src="../assets/logo.svg" alt="ORDIN" class="logo" />
      <span class="brand-name">ORDIN</span>
    </a>
    <nav class="nav row center gap-14">
      <a class="navlink" href="#" id="btnLogout">Logout</a>
    </nav>
  </div>
</header>

<main class="container sidebar-layout">
  <aside class="card sidebar">
    <a href="dashboard.html">Overview</a>
    <a class="active" href="contractors.html">Contractors</a>
    <a href="contracts.html">Contracts</a>
    <a href="settings.html">Organisation settings</a>
  </aside>

  <section class="card">
    <div class="row between center wrap gap-10">
      <div>
        <h1 class="m0">Contractors</h1>
        <p class="muted m0">Your invited and active contractors.</p>
      </div>
      <a class="btn primary" href="dashboard.html">Invite contractor</a>
    </div>

    <table class="table" style="margin-top:10px;">
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Readiness</th>
          <th>Contract</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </section>
</main>

<script src="../js/data.js"></script>
<script src="../js/ui.js"></script>
<script>
  const s = UI.requireAuth(["EMPLOYER"], "../auth/login.html");
  if (!s) return;
  const ctx = ORDIN.getMyContext();
  const db = ctx.db, org = ctx.org;

  const engs = db.engagements.filter(e => e.organisationId === org.id);
  const tbody = UI.qs("#rows");
  tbody.innerHTML = "";

  if (engs.length === 0) {
    tbody.innerHTML = `<tr><td colspan="5" class="muted">No contractors yet.</td></tr>`;
  } else {
    engs.forEach(e => {
      const ctr = db.contractors.find(c => c.id === e.contractorId);
      const contract = db.contracts.find(c => c.engagementId === e.id);
      tbody.insertAdjacentHTML("beforeend", `
        <tr>
          <td>${UI.esc(ctr ? (ctr.first_name+" "+ctr.last_name) : "(invited)")}</td>
          <td>${UI.esc(ctr ? ctr.contractor_type : "—")}</td>
          <td>${UI.badge(e.readiness)}</td>
          <td>${UI.esc(contract ? contract.status : "—")}</td>
          <td><a class="btn" href="contractor-detail.html?eng=${encodeURIComponent(e.id)}">View</a></td>
        </tr>
      `);
    });
  }

  UI.qs("#btnLogout").onclick = () => { ORDIN.logout(); UI.redirect("../index.html"); };
</script>
</body>
</html>
